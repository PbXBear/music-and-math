# 2021音数大作业-GA生成音乐片段

编码格式：
编码为3*32的数组。
行[0]：记录音类。C=0直至B=11，额外的，休止=12。
行[1]：记录所在的八度。C3~B3记为0，C4~B4记为1，C5~B5记为2。对于休止符，统一标为0。
行[2]：记录是否为延音。对于超过半拍的音或休止符，第一个半拍标0，之后的半拍依次标1, 2, ...。

交叉互换：
选取一个数，按照该长度进行两个串的切割和重新拼接，随机选取一个起点，拼接后各串长度不变
概率：长度为16 > 长度为8或24 > 长度为4的倍数但不是8的倍数 > 长度为偶数但不是4的倍数 > 奇数长度。按照每项5：4：3：2：1的概率抽取。
拼接后重算延音。

变异方式：

1. 修改某个半拍
   随机选取某个半拍，移动一个±11以内的随机大小，然后取模并调整八度
   delta = random.randint(-11, 11)
   choose = random.randint(0, 31)
   new_pitch = pitch[0][choose] + delta
   pitch[0][choose] = new_pitch % 12
   pitch[1][choose] += new_pitch // 12
   之后需要修改延音的记录。
2. 修改一整个音符<font color='red'>（依赖延音）</font>
   类似于“修改某个半拍”，但是选取一个半拍及其延音，进行整体移动
3. 修改某个音对应的八度<font color='red'>（依赖延音）</font>
   随机选取一个半拍及其延音，将其八度进行一个±1的变化（变化后仍在0~2范围内）
4. 节奏调整
   将某个半拍向前或向后延长一个半音的长度，覆盖掉对应位置的音

特殊变换

1. （关于音类的）倒影：选取C4做镜面，超过0-2的音域则平移
   随机选取一个[0, 12)范围内的整数对应的音高作为基准进行倒影
   delta = random.randint(0, 11)
   for i in range(0, 32):new_pitch = 2 * delta - pitch[0][i]
  类似修改半拍那样的取模操作

2. 逆行
   将整个片段的音高反序，之后需要修改延音的记录。
   
3. 移调：随机选取向上或向下移调，随机选取移调的delta，如果超出0-2的音域范围，则整体平移

适应度函数

1. 音阶外音
   逐个半拍确认，分档次给分：10：9：7：6：4：1
   在五声音阶上 0,2,4,7,9
   在自然音阶上 5,11
   不在自然音阶上，在小调和声音阶上 8
   不在小调和声音阶上，在小调旋律音阶上 6
   不在本调式音阶上，在相邻调式调号上 10
   不在以上范围内 1,3

2. 异常音程：每个相邻音之间判断

   同音超过1小节（超过一个全音符长度）：-4

   半音级进（1个半音）：-2

   大七度(11半音)：-3
   6半音跳进：-8
   超大跳（超过八度）：-8
   小七度大跳(10半音大跳)超过2个：每个-2
   跳进+大跳超过5个：每个-1

3. 和弦：
   按出现的音符推测和弦，给分
